---
title: "DOC_analysis"
author: "Wesley Sparagon"
date: "11/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Load libraries, read in data and metadata.

```{r}
library(ggplot2)
library(cowplot)

DOC_dat <- read.csv(file.path(dirOutput, "DOC_dat.csv"))
sym_dat_aquaria_final <- read.csv(file.path(dirOutput, "sym_dat_aquaria_final.csv"))
```

Mege sym_dat_aquaria_final and DOC_dat.

```{r}
DOC_dat1 <- merge(DOC_dat, sym_dat_aquaria_final, by.x="PLANC_aquaria", by.y="Group.1", all.x=T, all.y=F)
```

Normalize DOC to surface area.

```{r}
DOC_dat1$DOC_SA_Normalized = DOC_dat1$uMC/DOC_dat1$SA_no_outliers #normalize raw DOC
DOC_dat1$Control_Corrected_DOC_SA_Normalized = DOC_dat1$Control_Corrected_DOC/DOC_dat1$SA_no_outliers #normalize control corrected DOC
```

Reorder treatment factors.

```{r}
DOC_dat1$Treatment.x = factor(DOC_dat1$Treatment.x, levels=c("Non-bleached + Ambient", "Non-bleached + Heated", "Bleached + Ambient", "Bleached + Heated", "Ambient Water Control", "Heated Water Control"))
```


Visualize raw DOC data with water controls.

```{r}
#first subset for just t0 samples.
DOC_dat_t0 <- subset(DOC_dat1, Timepoint==0)
DOC_dat_t0$Treatment = DOC_dat_t0$Treatment.x

#visualize
ggplot(DOC_dat_t0,aes(x=Treatment,y=uMC,color=Treatment,fill=Treatment))+
  geom_boxplot(size=2)+
  geom_point(size=4)+
  scale_color_manual(values=c("#00BFC4","#F8766D","#00BFC4","#F8766D","black","gray"))+
  scale_fill_manual(values=c("dodgerblue3","firebrick3","NA","NA","NA","NA"))+
  theme(axis.text=element_text(size=18),axis.title=element_text(size=18))+
  labs(y="DOC (uM)")
#use this figure for a potential supplement
```

Check the distribution of raw DOC values.

```{r}
hist(DOC_dat_t0$uMC) #not very normal
hist(log10(DOC_dat_t0$uMC)) #still not normal
```

Since raw DOC values don't seem to be normal, test the effect of Treatment using a K-W test.

```{r}
kruskal.test(DOC_dat_t0$uMC, DOC_dat_t0$Treatment) #marginally significant

#double check with an ANOVA
mod.DOC.t0 = aov(uMC ~ Treatment, data=DOC_dat_t0)
summary(mod.DOC.t0) #not significant
```

Next, plot raw control corrected DOC values.

```{r}
ggplot(DOC_dat_t0,aes(x=Treatment,y=Control_Corrected_DOC,color=Treatment,fill=Treatment))+
  geom_boxplot(size=2)+
  geom_point(size=4)+
  scale_color_manual(values=c("#00BFC4","#F8766D","#00BFC4","#F8766D","black","gray"))+
  scale_fill_manual(values=c("dodgerblue3","firebrick3","NA","NA","NA","NA"))+
  theme(axis.text=element_text(size=18),axis.title=element_text(size=18))+
  labs(y="Control Corrected DOC (uM)")
```

Next plot coral specifc DOC values, first SA normalized DOC and then SA normalized control corrected DOC.

```{r}
ggplot(DOC_dat_t0[DOC_dat_t0$Origin_PlanC.x != "control",],aes(x=Treatment,y=DOC_SA_Normalized,color=Treatment,fill=Treatment))+
  geom_boxplot(size=2)+
  geom_point(size=4)+
  scale_color_manual(values=c("#00BFC4","#F8766D","#00BFC4","#F8766D"))+
  scale_fill_manual(values=c("dodgerblue3","firebrick3","NA","NA"))+
  theme(axis.text=element_text(size=18),axis.title=element_text(size=18))+
  labs(y="Surface Area Normalized DOC (uM cm-2)")

ggplot(DOC_dat_t0[DOC_dat_t0$Origin_PlanC.x != "control",],aes(x=Treatment,y=Control_Corrected_DOC_SA_Normalized,color=Treatment,fill=Treatment))+
  geom_boxplot(size=2)+
  geom_point(size=4)+
  scale_color_manual(values=c("#00BFC4","#F8766D","#00BFC4","#F8766D"))+
  scale_fill_manual(values=c("dodgerblue3","firebrick3","NA","NA"))+
  theme(axis.text=element_text(size=18),axis.title=element_text(size=18))+
  labs(y="Surface Area Normalized DOC (uM cm-2)")

```

