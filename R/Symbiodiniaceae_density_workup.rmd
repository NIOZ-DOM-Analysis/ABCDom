---
title: "Symbiodiniaceae_density_workup"
author: "Wesley Sparagon"
date: "10/12/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Goal: Process raw FCM sym data (remove outliers), then calculate sym density for each PLANC coral nubbin.

Load libraries and read in data.

```{r}
#load libraries
library(ggplot2)
library(cowplot)
library(FSA)

PLANC_Blastate_FCM <- read.csv(file.path(dirRAW, "Sym_Counts", "PLANC_Blastate_FCM.csv"), ) #load the raw FCM data
PLANC_Blastate_FCM_Sample_Map <- read.csv(file.path(dirRAW, "Sym_Counts", "PLANC_Blastate_FCM_Sample_Map.csv"), ) #load the FCM sample map data
PLANC_nubbin_sizing_notes <- read.csv(file.path(dirRAW, "Sym_Counts", "PLANC_nubbin_sizing_notes.csv"), ) #load the nubbin size notes

```

Merge the three data frames.

```{r}
#merge PLANC_Blastate_FCM and PLANC_Blastate_FCM_Sample_Map
dat <- merge(PLANC_Blastate_FCM,PLANC_Blastate_FCM_Sample_Map,by.x="ï..Tube.Name.",by.y="Plate_Well")

#merge dat and PLANC_nubbin_sizing_notes
sym_dat=merge(dat,PLANC_nubbin_sizing_notes,by.x="Sample",by.y="Code",all=T)
```

Calculate sym density per unit surface area for each nubbin.

```{r}
#work up the data
sym_dat$Notes.x[is.na(sym_dat$Notes.x)]="" #subset notes column for NAs and replace with ""
sym_dat$sym.conc=sym_dat$Sym.FSC.Events.Î.L.V. #make a new column corresponding to sym concentration. We will replace FSC concentration values with SSC concentration values in this column
sym_dat$sym.events=sym_dat$Sym.FSC.Events #make a new column corresponding to sym events. We will replace FSC events values with SSC events values in this column
sym_dat$sym.conc[sym_dat$Notes.x=="Use Sym-SSC Sym-SSC Events/Î¼L(V)"]=sym_dat$Sym.SSC.Events.Î.L.V.[sym_dat$Notes.x=="Use Sym-SSC Sym-SSC Events/Î¼L(V)"] #subset the sym.conc column for only values who correspond to the note suggestion to use SSC, and then replace those values with the corresponding SSC concentration.
sym_dat$sym.events[sym_dat$Notes.x=="Use Sym-SSC Sym-SSC Events/Î¼L(V)"]=sym_dat$Sym.SSC.Events[sym_dat$Notes.x=="Use Sym-SSC Sym-SSC Events/Î¼L(V)"] #subset the sym.events column for only values who correspond to the note suggestion to use SSC, and then replace those values with the corresponding SSC events.

#calculate total sym counts by multiplying sym.conc by "Vol" column (mL).
sym_dat$sym.total=sym_dat$sym.conc*sym_dat$Vol*1000

#calculate sym counts normalized to SA.
sym_dat$sym.SA=sym_dat$sym.total/sym_dat$SA
sym_dat$log10.sym.SA=log10(sym_dat$sym.SA)
```

Export as CSV to output directory.

```{r}
write.csv(sym_dat, file.path(dirOutput, "sym_dat.csv"), )
```

